server {
  listen 80;

  root /usr/share/nginx/html;
  index index.html;

  # Set max body size for uploads to 20MB
  client_max_body_size 20M;

  # Proxy API requests to backend (replace 'backend' with the actual Docker service name)
  location /api {
    resolver 127.0.0.11 valid=30s;  # Docker DNS
    proxy_pass http://backend:8080/api;  # Replace 'backend' with your backend service name

    # Set necessary headers for proxying multipart/form-data
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Ensure the body of the request is forwarded correctly (especially for large file uploads)
    proxy_set_header Content-Length $content_length;
    proxy_set_header Content-Type $content_type;

    # Allow larger file uploads specifically for API endpoints
    client_max_body_size 20M;  # Allow large file uploads for API
  }

  # Proxy authentication requests to Keycloak (ensure 'keycloak' is correct service name)
  location /auth {
    resolver 127.0.0.11 valid=30s;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Host $host;
    proxy_pass http://keycloak:3000/auth;  # Replace 'keycloak' with your keycloak service name
  }

  # Proxy MinIO requests to MinIO (ensure 'minio' is the correct service name)
  location /minio {
    resolver 127.0.0.11 valid=30s;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Host $host;
    proxy_pass http://minio:9000;  # Replace 'minio' with your MinIO service name
    client_max_body_size 20M;  # Allow large file uploads for MinIO
  }

}